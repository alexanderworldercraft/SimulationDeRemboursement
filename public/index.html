<!DOCTYPE html>
<html lang="fr" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation de Remboursement</title>
    <link rel="stylesheet" href="./tailwindcss.css">
</head>

<body class="container mx-auto text-center bg-violet-50 flex flex-col h-full gap-5">
    <header class="bg-violet-900 text-violet-100 xl:rounded-b-2xl p-4 shadow-lg">
        <h1 class="text-3xl font-bold">Simulation de Remboursement</h1>
    </header>
    <main class="flex flex-col gap-5 grow">
        <!-- Inputs pour la simulation -->
        <article>
            <section class="w-fit mx-auto">
                <div class="grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 w-fit mx-auto">
                    <div class="sm:col-span-6">
                        <div>
                            <label for="emprunt" class="block text-sm font-medium leading-6 text-violet-900">Valeur
                                d'emprunt</label>
                            <div class="relative mt-2 rounded-md shadow-sm">
                                <input type="text" name="emprunt" id="emprunt"
                                    class="block w-full rounded-md border-0 py-1.5 pl-7 pr-20 text-violet-900 ring-1 ring-inset ring-violet-300 placeholder:text-violet-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                                    placeholder="0.00">

                                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                    <span class="text-violet-500 sm:text-sm">€</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="sm:col-span-3">
                        <div>
                            <label for="interet" class="block text-sm font-medium leading-6 text-violet-900">Taux
                                d'intérêt annuel (%)</label>
                            <div class="relative mt-2 rounded-md shadow-sm">
                                <input type="text" name="interet" id="interet"
                                    class="block w-full rounded-md border-0 py-1.5 pl-7 pr-20 text-violet-900 ring-1 ring-inset ring-violet-300 placeholder:text-violet-400 focus:ring-2 focus:ring-inset focus:ring-violet-600 sm:text-sm sm:leading-6"
                                    placeholder="0.00">

                                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                    <span class="text-violet-500 sm:text-sm">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="sm:col-span-3">
                        <div>
                            <label for="remboursement" class="block text-sm font-medium leading-6 text-violet-900">Durée
                                de remboursement (mois)</label>
                            <div class="relative mt-2 rounded-md shadow-sm">
                                <input type="text" name="remboursement" id="remboursement"
                                    class="block w-full rounded-md border-0 py-1.5 px-2 text-violet-900 ring-1 ring-inset ring-violet-300 placeholder:text-violet-400 focus:ring-2 focus:ring-inset focus:ring-violet-600 sm:text-sm sm:leading-6"
                                    placeholder="00">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-6 mb-3 flex items-center justify-end">
                    <button id="simuler"
                        class="rounded-md bg-violet-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-violet-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-600">Simuler</button>
                </div>
            </section>
        </article>
        <!-- Tableau des coûts et du remboursement -->
        <article class="flex-col flex gap-5 mx-5 lx:mx-0">
            <!-- Tableau des coût -->
            <section class="overflow-x-auto bg-white rounded-lg shadow-lg overflow-y-auto relative border border-violet-300">
                <table id="tab1" class="border-collapse table-auto w-full whitespace-no-wrap bg-white table-striped relative">
                    <thead>
                        <tr class="text-left">
                            <th class="py-2 px-3 sticky top-0 border-b border-violet-200 bg-violet-100"><span class="bg-violet-100 sticky top-0 px-6 py-2 text-violet-600 font-bold tracking-wider uppercase text-xs">Coût total</span></th>
                            <th class="py-2 px-3 sticky top-0 border-b border-violet-200 bg-violet-100"><span class="bg-violet-100 sticky top-0 px-6 py-2 text-violet-600 font-bold tracking-wider uppercase text-xs">Valeur total des intérêt</span></th>
                            <th class="py-2 px-3 sticky top-0 border-b border-violet-200 bg-violet-100"><span class="bg-violet-100 sticky top-0 px-6 py-2 text-violet-600 font-bold tracking-wider uppercase text-xs">Coût des mensualités</span></th>
                        </tr>
                    </thead>
                    <tbody class="resultTab1">
                        <tr>
                            <td class="border-dashed border-t border-violet-200 px-3"><span id="coutTotal" class="text-violet-700 px-6 py-3 flex items-center">-</span></td>
                            <td class="border-dashed border-t border-violet-200 px-3"><span id="interetTotal" class="text-violet-700 px-6 py-3 flex items-center">-</span></td>
                            <td class="border-dashed border-t border-violet-200 px-3"><span id="mensualite" class="text-violet-700 px-6 py-3 flex items-center">-</span></td>
                        </tr>
                    </tbody>
                </table>
            </section>
            <!-- Tableau des Mensualités -->
            <section class="overflow-x-auto bg-white rounded-lg shadow-lg overflow-y-auto relative border border-violet-300">
                <table id="tab2" class="border-collapse table-auto w-full whitespace-no-wrap bg-white table-striped relative">
                    <thead>
                        <tr class="text-left">
                            <th class="py-2 px-3 sticky top-0 border-b border-violet-200 bg-violet-100"><span class="bg-violet-100 sticky top-0 px-6 py-2 text-violet-600 font-bold tracking-wider uppercase text-xs">Mois restant</span></th>
                            <th class="py-2 px-3 sticky top-0 border-b border-violet-200 bg-violet-100"><span class="bg-violet-100 sticky top-0 px-6 py-2 text-violet-600 font-bold tracking-wider uppercase text-xs">Valeur restante</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="border-dashed border-t border-violet-200 px-3"><span class="text-violet-700 px-6 py-3 flex items-center">-</span></td>
                            <td class="border-dashed border-t border-violet-200 px-3"><span class="text-violet-700 px-6 py-3 flex items-center">-</span></td>
                        </tr>
                    </tbody>
                </table>
            </section>
        </article>
    </main>
    <footer class="p-1 bg-violet-900 text-violet-100 xl:rounded-t-2xl"><h6 class="font-bold italic">Version 0.0.1</h6></footer>
    <script>
        document.getElementById('simuler').addEventListener('click', function () {
            const emprunt = parseFloat(document.getElementById('emprunt').value);
            const tauxAnnuel = parseFloat(document.getElementById('interet').value);
            const duree = parseInt(document.getElementById('remboursement').value);

            if (isNaN(emprunt) || isNaN(tauxAnnuel) || isNaN(duree) || emprunt <= 0 || tauxAnnuel < 0 || duree <= 0) {
                alert("Veuillez remplir correctement tous les champs.");
                return;
            }

            const tauxMensuel = tauxAnnuel / 12 / 100;
            const mensualite = emprunt * tauxMensuel / (1 - Math.pow(1 + tauxMensuel, -duree));
            const coutTotal = mensualite * duree;
            const interetTotal = coutTotal - emprunt;

            document.getElementById('coutTotal').textContent = Number(coutTotal.toFixed(2)).toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " €";
            document.getElementById('interetTotal').textContent = Number(interetTotal.toFixed(2)).toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " €";
            document.getElementById('mensualite').textContent = Number(mensualite.toFixed(2)).toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " €";

            const tab2 = document.getElementById('tab2');
            tab2.innerHTML = `
                    <tr class="text-left">
                        <th class="py-2 px-3 sticky top-0 border-b border-violet-200 bg-violet-100"><span class="bg-violet-100 sticky top-0 px-6 py-2 text-violet-600 font-bold tracking-wider uppercase text-xs">Mois restant</span></th>
                        <th class="py-2 px-3 sticky top-0 border-b border-violet-200 bg-violet-100"><span class="bg-violet-100 sticky top-0 px-6 py-2 text-violet-600 font-bold tracking-wider uppercase text-xs">Valeur restante</span></th>
                    </tr>
                `;

            let montantRestant = emprunt;
            for (let i = duree; i > 0; i--) {
                montantRestant -= mensualite - (montantRestant * tauxMensuel);
                const row = document.createElement('tr')
                row.setAttribute('class', 'group');
                row.innerHTML = `
                        <td class="group-hover:bg-violet-100 border-dashed border-t border-violet-200 px-3"><span class="text-violet-700 px-6 py-3 flex items-center">${i}</span></td>
                        <td class="group-hover:bg-violet-100 border-dashed border-t border-violet-200 px-3"><span class="text-violet-700 px-6 py-3 flex items-center">${Number(montantRestant.toFixed(2)).toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €</span></td>
                    `;
                tab2.appendChild(row);
            }
        });
    </script>
</body>

</html>